<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Buy 500 IH — Redirecting…</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{margin:0;background:#0b0e13;color:#e7eefc;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Arial;
         display:flex;min-height:100vh;align-items:center;justify-content:center}
    .box{width:100%;max-width:520px;background:#121826;border-radius:16px;padding:22px;box-shadow:0 12px 40px rgba(0,0,0,.35)}
    a{color:#9cc4ff}
  </style>
</head>
<body>
  <div class="box">
    <p>Opening checkout…</p>
    <p class="muted">If nothing happens, <a id="a" href="#" target="_blank" rel="noopener">click here</a>.</p>
    <p class="muted">Your <code>playerId</code> is added as metadata so your IH balance is credited automatically.</p>
  </div>

<script>
  // ===== Replace with your own values =====
  const PAYMENT_LINKS = [
    "https://thirdweb.com/pay/38a4a150-e9b7-4380-a820-1f0dee3a0deb",
    "https://thirdweb.com/pay/540a5b5b-c1e6-4142-8ca0-4c30cee46969"
  ];
  // =======================================

  function pickLink(){
    const i = Number(localStorage.getItem("ih_link_idx") || "0");
    localStorage.setItem("ih_link_idx", String((i+1) % PAYMENT_LINKS.length));
    return PAYMENT_LINKS[i % PAYMENT_LINKS.length];
  }
  function nextUrl(){ const p=new URLSearchParams(location.search); return p.get("next") || "/"; }

  const pid = localStorage.getItem("ih_playfab_id") || "";
  if(!pid){
    // bounce to login, then back to here
    const here = location.pathname + location.search;
    location.replace(`/login.html?next=${encodeURIComponent(here)}`);
  }else{
    const link = pickLink();
    const url  = link + "?metadata=" + encodeURIComponent(JSON.stringify({ playerId: pid }));
    document.getElementById("a").href = url;
    // prefer same-tab replace (GitHub Pages sometimes blocks window.open)
    location.replace(url);
  }
</script>
</body>
</html>
